var e=Object.prototype.hasOwnProperty,n=Object.getOwnPropertySymbols,t=Object.prototype.propertyIsEnumerable,a=Object.assign;import{c as o}from"./clientRender.ea786f29.js";const s={};function i(i){var{components:r}=i,l=((a,o)=>{var s={};for(var i in a)e.call(a,i)&&o.indexOf(i)<0&&(s[i]=a[i]);if(null!=a&&n)for(var i of n(a))o.indexOf(i)<0&&t.call(a,i)&&(s[i]=a[i]);return s})(i,["components"]);return o("wrapper",a(a(a({},s),l),{components:r,mdxType:"MDXLayout"}),o("h2",null,"Advanced Filesystem Routing: findPages API"),o("blockquote",null,o("p",{parentName:"blockquote"},'The "Basic Filesystem Routing Convention" should satisfy most users\' needs. ',o("strong",{parentName:"p"},"You probably don't need to read this advanced guide"),".")),o("p",null,"For advanced users, vite-pages let you implement your own filesystem routing convention: you can ",o("strong",{parentName:"p"},"teach vite-pages how to collect pages from your project"),"."),o("p",null,"When ",o("a",a({parentName:"p"},{href:"https://github.com/vitejs/vite-plugin-react-pages/blob/master/fixtures/custom-find-pages/vite.demos.ts"}),"configuring vite-plugin-react-pages"),", you can pass the ",o("inlineCode",{parentName:"p"},"findPages")," option."),o("p",null,"Here is the definition of the vite-plugin-react-pages config function:"),o("pre",null,o("code",a({parentName:"pre"},{className:"language-ts"}),"function pluginFactory(\n  opts: {\n    pagesDir?: string\n    findPages?: (helpers: IFindPagesHelpers) => Promise<void>\n    useHashRouter?: boolean\n    staticSiteGeneration?: {}\n  } = {}\n): VitePlugin\n\ninterface IFindPagesHelpers {\n  /**\n   * readFile util with cache\n   */\n  readFile: (filePath: string) => Promise<string>\n  /**\n   * Read the static data from a file.\n   */\n  extractStaticData: (\n    filePath: string\n  ) => Promise<{\n    [key: string]: any\n    sourceType: string\n  }>\n  /**\n   * Glob utils. Return matched file paths.\n   */\n  globFind: (\n    baseDir: string,\n    glob: string\n  ) => Promise<\n    {\n      relative: string\n      absolute: string\n    }[]\n  >\n  /**\n   * Use the basic filesystem routing convention to find pages.\n   */\n  defaultFindPages: (baseDir: string) => Promise<IPageData[]>\n  /**\n   * Register page data.\n   * User who custom findPages should use it to register the data he/she finds.\n   */\n  addPageData: (pageData: IPageData) => void\n}\n\ninterface IPageData {\n  /**\n   * The page route path.\n   * User can register multiple page data with same pageId,\n   * as long as they have different keys.\n   * Page data with same pageId will be merged.\n   *\n   * @example '/posts/hello-world'\n   */\n  pageId: string\n  /**\n   * The data key.\n   * If it conflicts with an already-registered data,\n   * error will be thrown.\n   *\n   * @default 'main'\n   */\n  key?: string\n  /**\n   * The path to the runtime data module\n   */\n  dataPath?: string\n\n  staticData?: any\n}\n")),o("p",null,"You can implement your own filesystem routing convention with the ",o("inlineCode",{parentName:"p"},"findPages")," API. It provides some useful helper functions to you. It even let you create a page with runtime data that is composed of multiple files."),o("h3",null,"Composed Pages"),o("p",null,"Normal filesystem routing mechanism assumes that one page must have a single entry file. But vite-pages doesn't force that rule! ",o("strong",{parentName:"p"},"Vite-pages let you create a page with runtime data that is composed of multiple files.")," This is a very powerful feature of vite-pages's filesystem routing mechanism."),o("p",null,"While collecting pages data with ",o("inlineCode",{parentName:"p"},"addPageData"),", you can register multiple data with same ",o("inlineCode",{parentName:"p"},"pageId"),". Page data with same ",o("inlineCode",{parentName:"p"},"pageId")," will be merged."),o("h4",null,"Example"),o("p",null,"For example, suppose you are developing a React component library. Your project have file structure like this:"),o("pre",null,o("code",a({parentName:"pre"},{className:"language-text"}),"src\n├── Button\n│   ├── demos\n│   │   ├── demo1.tsx\n│   │   └── demo2.tsx\n│   ├── index.tsx\n│   └── style.module.css\n├── Card\n│   ├── demos\n│   │   ├── demo1.tsx\n│   │   └── demo2.tsx\n│   ├── index.tsx\n│   └── style.module.css\n└── index.ts\n")),o("p",null,'You want to use Vite as your local demo development environment. How to collect demos of all components from this project? The file structure doesn\'t follow our "Basic Filesystem Routing Convention".'),o("p",null,"Answer: use ",o("inlineCode",{parentName:"p"},"findPages")," API to implement your own filesystem routing convention! Here is an example of the vite-plugin-react-pages config function:"),o("pre",null,o("code",a({parentName:"pre"},{className:"language-ts"}),"pages({\n  pagesDir: path.join(__dirname, 'pages'),\n  findPages: async (helpers) => {\n    const pagesByComponent: { [comp: string]: any } = {}\n    const demosBasePath = path.join(__dirname, 'src')\n    // find all demo modules\n    let demoPaths = await helpers.globFind(\n      demosBasePath,\n      '*/demos/**/*.{[tj]sx,md?(x)}'\n    )\n\n    await Promise.all(\n      demoPaths.map(async ({ relative, absolute }) => {\n        const match = relative.match(/(.*)\\/demos\\/(.*)\\.([tj]sx|mdx?)$/)\n        if (!match) throw new Error('unexpected file: ' + absolute)\n        const [_, componentName, demoPath] = match\n        const publicPath = `/${componentName}`\n\n        // register the demo module as page daga\n        helpers.addPageData({\n          pageId: publicPath,\n          key: demoPath,\n          dataPath: absolute,\n          staticData: await helpers.extractStaticData(absolute),\n        })\n\n        if (!pagesByComponent[componentName]) {\n          pagesByComponent[componentName] = {\n            publicPath,\n          }\n        }\n      })\n    )\n\n    // add static data(title) for each component page\n    Object.entries(pagesByComponent).forEach(\n      ([componentName, { publicPath }]) => {\n        helpers.addPageData({\n          pageId: publicPath,\n          key: 'title',\n          staticData: componentName + ' Title',\n        })\n      }\n    )\n\n    // we also want to collect pages from `/pages` with basic filesystem routing convention\n    const defaultPages = await helpers.defaultFindPages(\n      path.join(__dirname, 'pages')\n    )\n    defaultPages.forEach(helpers.addPageData)\n  },\n}),\n")),o("p",null,"Checkout the complete example in ",o("a",a({parentName:"p"},{href:"https://github.com/vitejs/vite-plugin-react-pages/tree/master/fixtures/custom-find-pages"}),"the custom-find-pages fixture"),"."))}i.isMDXComponent=!0;var r=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:i});const l={};l.main=r;export default l;
